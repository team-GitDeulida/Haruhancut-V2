# PRì— ëŒ“ê¸€ ì‘ì„±
#     â†“
# issue_comment ì´ë²¤íŠ¸ ë°œìƒ
#     â†“
# job ì¡°ê±´ ê²€ì‚¬
#     â†“
# ì¡°ê±´ ì•ˆ ë§ìœ¼ë©´ âŒ job ìì²´ê°€ ì‹¤í–‰ ì•ˆ ë¨
# ì¡°ê±´ ë§ìœ¼ë©´ âœ… ì‹¤í–‰

name: PR ëª…ë ¹ì–´ ì‹¤í–‰

on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write
  pull-requests: write
  actions: write

jobs:
  parse-and-run:
    if: >
      github.event.issue.pull_request != null &&
      github.event.comment.user.type == 'User' &&
      startsWith(github.event.comment.body, '/í•˜ë£¨í•œì»· ë¹Œë“œí•˜ê³  í…ŒìŠ¤íŠ¸')
    runs-on: ubuntu-latest
    steps:
      - name: Acknowledge
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ”¨ iOS 18.5 iPhone 16 Pro Max ì—ì„œ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

      - name: Trigger build-and-test workflow
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.issue.number;

            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: prNumber,
            });

            const ref = pr.head.ref;

            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: "build-and-test.yml",
              ref,
              inputs: {
                triggered_by_command: "true",
                pr_number: String(prNumber),
              },
            });
